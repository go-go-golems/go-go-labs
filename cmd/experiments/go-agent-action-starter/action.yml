name: "Agent Code Action (Go)"
description: "Go-based GitHub Action that bundles PR context and routes it to your own tool (HTTP or CLI), then posts the result as a PR review or comment."
branding:
  icon: "zap"
  color: "blue"

inputs:
  trigger_phrase:
    description: "Trigger phrase to look for in comments or PR body (e.g. @agent)"
    required: false
    default: "@agent"
  label_trigger:
    description: "Optional label that triggers the action on PRs"
    required: false
    default: ""
  assignee_trigger:
    description: "Optional assignee username that triggers the action"
    required: false
    default: ""
  guidelines_path:
    description: "Path to a repo file with review guidelines (compatible with CLAUDE.md)"
    required: false
    default: "CLAUDE.md"
  include_patch:
    description: "Include unified diff (patch) for each changed file"
    required: false
    default: "true"
  include_file_contents:
    description: "Include full file contents for changed files (respecting max_file_bytes)"
    required: false
    default: "false"
  include_repo_globs:
    description: "Comma-separated globs to include extra repo files in context (e.g. docs/**/*.md,.github/*.md)"
    required: false
    default: ""
  max_file_bytes:
    description: "Max bytes per file to include when include_file_contents=true"
    required: false
    default: "200000"
  max_changed_files:
    description: "Cap the number of PR changed files collected"
    required: false
    default: "200"

  tool_mode:
    description: "How to call your tool: mock | http | cmd"
    required: false
    default: "mock"
  tool_url:
    description: "When tool_mode=http, the URL to POST the JSON context to"
    required: false
    default: ""
  tool_method:
    description: "HTTP method to use (POST|PUT) when tool_mode=http"
    required: false
    default: "POST"
  tool_headers_json:
    description: "Optional JSON object of headers to send with HTTP call"
    required: false
    default: "{}"
  tool_token:
    description: "Optional bearer token added as Authorization: Bearer ... for HTTP mode"
    required: false
    default: ""

  tool_cmd:
    description: "When tool_mode=cmd, the command (binary) to execute"
    required: false
    default: ""
  tool_args_json:
    description: "When tool_mode=cmd, JSON array of args for the command"
    required: false
    default: "[]"
  working_directory:
    description: "Working directory for CLI tool (defaults to workspace)"
    required: false
    default: ""

  output_mode:
    description: "Where to post results: review | comment | summary | stdout | review+summary"
    required: false
    default: "review+summary"
  max_comments:
    description: "Max inline comments to post (review mode)"
    required: false
    default: "30"

  github_token:
    description: "GitHub token; defaults to GITHUB_TOKEN"
    required: false
    default: ""

runs:
  using: "docker"
  image: "Dockerfile"
  args:
    - "--trigger_phrase"
    - "${{ inputs.trigger_phrase }}"
    - "--label_trigger"
    - "${{ inputs.label_trigger }}"
    - "--assignee_trigger"
    - "${{ inputs.assignee_trigger }}"
    - "--guidelines_path"
    - "${{ inputs.guidelines_path }}"
    - "--include_patch"
    - "${{ inputs.include_patch }}"
    - "--include_file_contents"
    - "${{ inputs.include_file_contents }}"
    - "--include_repo_globs"
    - "${{ inputs.include_repo_globs }}"
    - "--max_file_bytes"
    - "${{ inputs.max_file_bytes }}"
    - "--max_changed_files"
    - "${{ inputs.max_changed_files }}"
    - "--tool_mode"
    - "${{ inputs.tool_mode }}"
    - "--tool_url"
    - "${{ inputs.tool_url }}"
    - "--tool_method"
    - "${{ inputs.tool_method }}"
    - "--tool_headers_json"
    - "${{ inputs.tool_headers_json }}"
    - "--tool_token"
    - "${{ inputs.tool_token }}"
    - "--tool_cmd"
    - "${{ inputs.tool_cmd }}"
    - "--tool_args_json"
    - "${{ inputs.tool_args_json }}"
    - "--working_directory"
    - "${{ inputs.working_directory }}"
    - "--output_mode"
    - "${{ inputs.output_mode }}"
    - "--max_comments"
    - "${{ inputs.max_comments }}"
    - "--github_token"
    - "${{ inputs.github_token }}"
